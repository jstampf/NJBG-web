!function(e,t){"use strict";function a(t,a){var o,n=this,i="";if(O.call(n,t,a))return n.$root=e('<div class="smbLightOverlayWrapper initializing"><div class="contentWrapper" /></div>'),n.$root.addClass(n.options.cssClass),n.$contentWrapper=e("> div.contentWrapper",n.$root),t.length>1&&(i='<span class="navigation prev"><span /></span><span class="navigation next"><span /></span>'),i+='<span class="close"><span /></span><div class="socialButtonsWrapper"></div><span class="actions socialButtonsTrigger"><span>'+H.call(n,"Share")+"</span></span>",n.$mainWrapper=e('<div class="mainWrapper"><div class="viewWrapper"><div class="images"><p>'+H.call(n,"This image is currently unavailable")+'</p></div><div class="audioVideo" /></div>'+i+"</div>").appendTo(n.$contentWrapper),n.$itemTitle=e('<div class="itemHeader" />').appendTo(n.$mainWrapper),n.$loadingOverlay=e('<div class="loadingOverlay inProgress" />').appendTo(n.$mainWrapper),n.$imagesWrapper=e("> .viewWrapper > .images",n.$mainWrapper),n.$audioVideo=e("> .viewWrapper > .audioVideo",n.$mainWrapper),n.$socialButtonsWrapper=e(".socialButtonsWrapper",n.$mainWrapper),n.$socialButtonsTrigger=e(".socialButtonsTrigger",n.$mainWrapper),o=n.items[n.currentItemIndex],"image"==o.type?g.call(n,n.currentItemIndex,function(){$.call(n)}):$.call(n),n.$root.appendTo(n.$body),n.main={horizontalSpace:n.$mainWrapper.outerWidth(!0)-n.$mainWrapper.width(),verticalSpace:n.$mainWrapper.outerHeight(!0)-n.$mainWrapper.height()},x.call(n),n.$root.fadeTo(200,1,function(){"image"!=o.type&&b.call(n)}),P.call(n),n}function o(t,a){var o=this,n="";if(o.smbPlus=!0,O.call(o,t,a)){if(o.options.wrapperResizeDuration=0,o.$viewportMeta=e('meta[name="viewport"]'),o.oldViewportMetaContent=void 0,o.$viewportMeta.length>0?(o.oldViewportMetaContent=o.$viewportMeta.attr("content"),o.$viewportMeta.attr("content","user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1")):o.$viewportMeta=e('<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1" />').appendTo(e("head")),o.$ieTapHighlight=e('meta[name="msapplication-tap-highlight"]'),o.oldIeTapHighlight=void 0,o.$ieTapHighlight.length>0?(o.oldIeTapHighlight=o.$ieTapHighlight.attr("content"),o.$ieTapHighlight.attr("content","no")):o.$ieTapHighlight=e('<meta name="msapplication-tap-highlight" content="no" />').appendTo(e("head")),o.$root=e('<div class="smbLightOverlayWrapper smbPlus initializing"><div class="contentWrapper"></div></div>').addClass(o.options.cssClass),/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase())||(o.$root.addClass("desktopUserAgent"),o.desktopVersion=!0),o.$contentWrapper=e("> div.contentWrapper",o.$root),n='<div class="mobileOverlay" /><div class="modalOverlay" />',t.length>1&&(n+='<span class="navigation prev"><span /></span><span class="navigation next"><span /></span>'),n+='<span class="close"><span /></span><div class="socialButtonsWrapper"></div><span class="actions socialButtonsTrigger"><span>'+H.call(o,"Share")+"</span></span>",o.$root.append(n),o.$itemTitle=e('<div class="itemHeader" />').appendTo(o.$root),o.$socialButtonsWrapper=e(".socialButtonsWrapper",o.$root),o.$socialButtonsTrigger=e(".socialButtonsTrigger",o.$root),o.$modalOverlay=e("> .modalOverlay",o.$root),o.options.comments.permissions.show){o.comments={},o.$root.append('<span class="actions commentsTrigger"><span>0</span></span><div class="commentsModalWrapper"><div class="main"><div class="top"><span class="comments">0</span><span class="likes">0</span><span class="sort">'+H.call(o,"Sort")+'</span></div><ul /><p class="noComments">'+H.call(o,"No comments yet")+'</p><div class="newCommentWrapper"><textarea placeholder="'+H.call(o,"Write a comment")+'"></textarea><button>'+H.call(o,"Post")+'</button></div></div><div class="anonymCommentWrapper"><p>'+H.call(o,"Add a comment")+'</p><div class="authorName"><input type="text" placeholder="'+H.call(o,"Name")+'" /></div><div class="authorEmail"><input type="text" placeholder="'+H.call(o,"Email")+'" /></div><div class="authorTextarea"><textarea placeholder="'+H.call(o,"Write a comment")+'"></textarea></div><div class="actions"><button class="cancel">'+H.call(o,"Cancel")+'</button><button class="post">'+H.call(o,"Post")+'</button></div></div><span class="closeComments">'+H.call(o,"Hide")+'</span><p class="loading">'+H.call(o,"Loading comments")+"</p></div>"),o.$commentsTrigger=e("> .actions.commentsTrigger",o.$root),o.$mainCommentsCount=e("> span",o.$commentsTrigger),o.$commentsModal=e("> .commentsModalWrapper",o.$root),o.$commentsMainWrapper=e("> .main",o.$commentsModal),o.$newCommentWrapper=e("> .newCommentWrapper",o.$commentsMainWrapper),o.$newCommentInput=e("> textarea",o.$newCommentWrapper),o.$newCommentButton=e("> button",o.$newCommentWrapper),o.$commentsTopBar=e("> .top",o.$commentsMainWrapper),o.$internalCommentsCount=e("> .comments",o.$commentsTopBar),o.$commentsLikes=e("> .likes",o.$commentsTopBar),o.$commentsSorting=e("> .sort",o.$commentsTopBar),o.$commentList=e("> ul",o.$commentsMainWrapper),o.$anonymCommentWrapper=e("> .anonymCommentWrapper",o.$commentsModal),o.$anonymCommenterNameInput=e("> .authorName > input",o.$anonymCommentWrapper),o.$anonymCommenterEmailInput=e("> .authorEmail > input",o.$anonymCommentWrapper),o.$anonymCommentInput=e("> .authorTextarea > textarea",o.$anonymCommentWrapper),o.$anonymCommentCancel=e("> .actions > .cancel",o.$anonymCommentWrapper),o.$anonymCommentPost=e("> .actions > .post",o.$anonymCommentWrapper),o.commentSorting="asc",o.addingAjaxRequest=void 0,o.commentsOpened=!1,o.commentsAnimationTimeout,o.$commentsTrigger.on("click",function(){return o.desktopVersion&&1==o.commentsOpened?void o.closeComments():(o.updateItemComments(),void(o.desktopVersion?(o.commentsOpened=!0,clearTimeout(o.commentsAnimationTimeout),o.$root.addClass("animateComments moveComments"),o.commentsAnimationTimeout=setTimeout(function(){o.$root.removeClass("animateComments moveComments"),o.$root.width(o.$root.width()-o.$commentsModal.outerWidth(!0)),x.call(o)},200)):(o.$root.addClass("modalActive"),o.$modalOverlay.stop(!0).animate({opacity:1},{duration:200}))))}),o.$commentsSorting.on("click",function(){"asc"==o.commentSorting?o.commentSorting="desc":o.commentSorting="asc",o.$commentsSorting.toggleClass("desc","desc"==o.commentSorting),S.call(o)}),o.$commentsModal.on("click","> span.closeComments",function(){o.closeComments()}),o.$newCommentInput.on("change keyup",function(){var e=o.$newCommentInput.val();o.$newCommentWrapper.toggleClass("filledIn",""!==e)}).on("focus",function(){o.options.comments.requireAuthorInfo&&(o.$anonymCommenterNameInput.trigger("focus").val(""),o.$anonymCommenterEmailInput.val(""),o.$anonymCommentInput.val(""),o.$commentsModal.addClass("showAnonymWindow"))}),o.$anonymCommentCancel.on("click",function(){o.$commentsModal.removeClass("showAnonymWindow"),o.$anonymCommentWrapper.removeClass("addingAnonComment"),o.addingAjaxRequest&&(o.addingAjaxRequest.abort(),o.addingAjaxRequest=void 0)});var i=function(t,a,n,i,s){var r=o.currentItemIndex,m=o.items[r],l=o.comments[m.id],c=o.options.comments.requireAuthorInfo?i:o.$newCommentInput.val(),d={action:"add_comment"};""===c||o.$newCommentWrapper.hasClass("addingComment")||(o.$newCommentWrapper.addClass("addingComment"),o.$newCommentInput.val(""),o.$newCommentWrapper.removeClass("filledIn"),d.comment=c,o.options.comments.requireAuthorInfo&&(d.name=a,d.email=n),o.addingAjaxRequest=e.ajax({data:d,dataType:"json",type:"POST",url:m.comments.backend,timeout:15e3,cache:!1,error:function(){},success:function(e){void 0!=e.status&&"success"==e.status&&(l.cache.comments.push({author:e.author.id,content:e.comment,raw:c,id:e.id,dateHtml:e.dateHtml}),l.count+=1,void 0==l.cache.authors[e.author.id]&&(l.cache.authors[e.author.id]={avatar:e.author.avatar,name:e.author.name,url:e.author.url}))},complete:function(){o.addingAjaxRequest=void 0,l.state.open&&r==o.currentItemIndex&&("function"==typeof s&&s(),o.$newCommentWrapper.removeClass("addingComment"),S.call(o))}}))};o.$anonymCommentPost.on("click",function(){var e=o.$anonymCommenterNameInput.val(),t=o.$anonymCommenterEmailInput.val(),a=o.$anonymCommentInput.val(),n=!1;o.$anonymCommenterNameInput.attr("placeholder",H.call(o,"Name")),o.$anonymCommenterEmailInput.attr("placeholder",H.call(o,"Email")),o.$anonymCommentInput.attr("placeholder",H.call(o,"Write a comment")),o.$anonymCommenterNameInput.parent().removeClass("error"),o.$anonymCommenterEmailInput.parent().removeClass("error"),o.$anonymCommentInput.parent().removeClass("error"),e||(o.$anonymCommenterNameInput.attr("placeholder",H.call(o,"Please specify your name")).parent().addClass("error"),n=!0),t&&v.test(t)||(o.$anonymCommenterEmailInput.attr("placeholder",H.call(o,"Please specify your email")).parent().addClass("error"),n=!0),a||(o.$anonymCommentInput.attr("placeholder",H.call(o,"Please write a comment")).parent().addClass("error"),n=!0),n||(o.$anonymCommentWrapper.addClass("addingAnonComment"),o.$anonymCommentPost.text(H.call(o,"Commenting")),i({},e,t,a,function(){o.$commentsModal.removeClass("showAnonymWindow"),o.$anonymCommentWrapper.removeClass("addingAnonComment"),o.$anonymCommentPost.text(H.call(o,"Post"))}))}),o.$newCommentButton.on("click",i)}o.options.like.permissions.liking&&(o.$root.append('<span class="actions likeTrigger"><span>0</span></span>'),o.$likeTrigger=e("> .actions.likeTrigger",o.$root),o.$mainLikeCount=e("> span",o.$likeTrigger),o.$likeTrigger.on("click",function(){if(!o.$root.hasClass("initializing")){var t=o.currentItemIndex,a=o.items[t],n=!a.likes.likedByUser,i={portalId:o.options.portalId,moduleId:o.options.moduleId,mediaId:a.id};a.likes.likedByUser=n,n?a.likes.numOfLikes+=1:a.likes.numOfLikes>0&&(a.likes.numOfLikes-=1),o.$mainLikeCount.text(a.likes.numOfLikes),o.$likeTrigger.toggleClass("liked",n),"number"==typeof a.journalId?(i.action="like",i.journalid=a.journalId,i.liked=n):(i.action="media_like",i.vote=n?1:-1),e.ajax({data:i,dataType:"json",type:"POST",url:o.options.websiteRoot+"DesktopModules/EasyDNNGallery/Services/SocialMediaBox.ashx",timeout:1e4,cache:!1,error:function(){},success:function(){},complete:function(){}})}})),o.$root.appendTo(o.$body),o.main={horizontalSpace:0,verticalSpace:0},e.each(o.items,function(t){var a=e("<div />");a.addClass("loading item_"+t).data("itemIndex",t),"image"==this.type?a.addClass("imageItem"):"video"==this.type?a.addClass("videoItem"):"audio"==this.type&&a.addClass("audioItem"),a.appendTo(o.$contentWrapper)}),x.call(o),o.$root.addClass("show"),setTimeout(function(){b.call(o)},200);var s=new Hammer(e("> .mobileOverlay",o.$root)[0]);o.skipGestures=!1;var r;return s.on("swipeleft swiperight panleft panright panend tap",function(e){var a=-(o.currentItemIndex*o.overlayWidth),n=e.deltaX;if("tap"==e.type)return clearTimeout(r),void(o.$root.hasClass("hideControls")?o.$root.removeClass("hideControls fadeOutControls"):(o.$root.addClass("fadeOutControls"),r=setTimeout(function(){o.$root.addClass("hideControls")},500)));if(!o.skipGestures&&o.initialItemLoaded){if(("swipeleft"==e.type||"swiperight"==e.type)&&t.length>1)return void("swipeleft"==e.type&&(o.currentItemIndex<o.items.length-1?B.call(o):0==o.currentItemIndex&&L.call(o)));if("panend"==e.type){if(0==o.currentItemIndex&&n>=0||o.currentItemIndex==o.items.length-1&&0>n||Math.abs(n)<o.overlayWidth/2)return void o.$contentWrapper.removeClass(u).addClass(p).css({transform:"translate3d("+a+"px, 0, 0)"});o.skipGestures=!0;var i=-o.overlayWidth,s=1;return n>0&&(i=o.overlayWidth,s=-1),i=a+i,o.$contentWrapper.addClass(p).removeClass(u).css({transform:"translate3d("+i+"px, 0, 0)"}),void setTimeout(function(){o.skipGestures=!1,o.currentItemIndex+=s,b.call(o)},550)}(0==o.currentItemIndex&&n>=0||o.currentItemIndex==o.items.length-1&&0>n)&&(n=1-Math.abs(n)/o.overlayWidth,.5>n?(n=Math.round(o.overlayWidth/4),e.deltaX<1&&(n=-n)):n=Math.round(n*e.deltaX)),o.$contentWrapper.removeClass(p).removeClass(u).css({transform:"translate3d("+(a+n)+"px, 0, 0)"})}}),P.call(o),o}}var n={portalId:0,moduleId:0,tabId:0,userLoggedIn:!1,websiteRoot:"",openAt:0,wrapperResizeDuration:200,flowplayerSwf:"",flowplayer:{key:"",logo:""},socialButtons:{facebook:!1,gplus:!1,twitter:!1,inshare:!1,pinterest:!1},cssClass:"",events:{onBeforeClose:function(){}},comments:{requireAuthorInfo:!0,permissions:{show:!1,commenting:!1}},like:{permissions:{liking:!1}},mobile:!1,i18n:{}},i={UNSET:0,SENT:1,DONE:2},s="activeElement",r="imageNotLoaded",m="smbLightFixed",l="audioItem",c="videoItem",d="imageItem",p="positionAnimation",u="swipeAnimation",h="initialized",v=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,g=function(t,a){var o=this,n=o.items[t];if("image"==n.type){var i=o.images[n.src];if(i)return void("function"==typeof a&&(i.stats.preloadFinished?a(i.stats):i.callbacks.push(a)));i=o.images[n.src]={callbacks:[],stats:{preloadFinished:!1,isLoaded:!1,width:0,height:0}},"function"==typeof a&&i.callbacks.push(a);var s=e('<img class="smbLightImage_'+n.id+'" />');s.imagesLoaded().progress(function(e,t){if(!o.viewClosed){var a=o.images[n.src];if(a.stats.preloadFinished=!0,a.stats.isLoaded=t.isLoaded,!o.smbPlus&&t.isLoaded&&o.$imagesWrapper.append(s),a.stats.width=s.width(),a.stats.height=s.height(),o.smbPlus)s.css(f.call(o,a.stats.width,a.stats.height,!1)),s.parent().removeClass("loading");else{var i=o.items[o.currentItemIndex];"image"==i.type&&i.src==n.src&&(o.initialItemLoaded=!0,b.call(o))}s=null;for(var r=0,m=a.callbacks.length;m>r;r++)a.callbacks[r](a.stats)}}),o.smbPlus&&s.appendTo(e("> div.item_"+t,o.$contentWrapper)),s.attr("src",n.src)}},$=function(){for(var e=this,t=0,a=e.items.length;a>t;t++)g.call(e,t)},f=function(e,t,a,o){var n,i,s=this,r=s.overlayWidth-s.main.horizontalSpace,m=s.overlayHeight-s.main.verticalSpace,l=e,c=t;return(a||e>r||t>m)&&(n=r/m,i=e/t,l=r,c=m,n>i?l=Math.round(m/t*e):i>n&&(c=Math.round(r/e*t))),o&&(c=t),{width:l,height:c,top:Math.floor((m-c)/2),left:Math.floor((r-l)/2)}},C=function(e){var t=this,a=function(){t.$loadingOverlay.stop(!0).fadeTo(200,0,function(){t.$loadingOverlay.css("display","none")}),W.call(t)},o=function(e,a){0==t.options.wrapperResizeDuration?(t.$mainWrapper.css(e),a()):t.$mainWrapper.stop(!0).animate(e,{duration:t.options.wrapperResizeDuration,complete:function(){t.$mainWrapper.css("overflow",""),a()}})},n=function(){t.$mainWrapper.height()!=e.height?o({height:e.height,top:e.top},a):a()};t.$loadingOverlay.removeClass("inProgress"),t.$mainWrapper.width()!=e.width?o({width:e.width,left:e.left},n):n()},I=function(t){var a,o,n=this,i=n.images[t.src].stats;i.preloadFinished&&(n.$mainWrapper.addClass(d),e("> img",n.$imagesWrapper).removeClass(s).filter(".smbLightImage_"+t.id).addClass(s),i.isLoaded?(a=i.width,o=i.height):(a=400,o=400,n.$imagesWrapper.addClass(r)),n.$imagesWrapper.addClass(s),C.call(n,f.call(n,a,o)))},w=function(t){var a=this,o="",n="",i=a.items[t];switch(a.smbPlus||a.$mainWrapper.addClass(c),i.source){case"youtube":o='<iframe src="//www.youtube.com/embed/'+i.videoId+'" frameborder="0" allowfullscreen></iframe>';break;case"vimeo":o='<iframe src="//player.vimeo.com/video/'+i.videoId+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';break;case"wistia":o='<iframe name="wistia_embed" src="//fast.wistia.net/embed/iframe/'+i.videoId+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';break;case"flowplayer":A(i.src,".mp4")?n="video/mp4":A(i.src,".webm")?n="video/webm":A(i.src,".ogg")?n="video/ogg":A(i.src,".flv")&&(n="video/flash"),o='<div class="flowplayerContainer"></div>'}var r=a.$audioVideo;a.smbPlus?("flowplayer"!=i.source&&(o="<div>"+o+"</div>"),r=e("> div.item_"+a.currentItemIndex,a.$contentWrapper)):r.addClass(s),r.html(o).removeClass("loading"),"flowplayer"==i.source&&e("> .flowplayerContainer",r).flowplayer({swf:a.options.flowplayerSwf,ratio:i.height/i.width,tooltip:!1,embed:!1,clip:{sources:[{type:n,src:i.src}]},key:a.options.flowplayer.key,logo:a.options.flowplayer.logo});var m=f.call(a,i.width,i.height,!0);a.smbPlus?e(">",r).css(m):C.call(a,m),a.initialItemLoaded=!0},y=function(t){var a=this;a.smbPlus||a.$mainWrapper.addClass(l);var o=a.$audioVideo,n='<audio src="'+t.src+'" />',i="> audio";a.smbPlus?(n="<div>"+n+"</div>",i="> div > audio",o=e("> div.item_"+a.currentItemIndex,a.$contentWrapper)):o.addClass(s),o.html(n).removeClass("loading"),audiojs.create(e(i,o)[0]);var r=f.call(a,460,36,!1,!0);a.smbPlus?e(">",o).css(r):C.call(a,r),a.initialItemLoaded=!0},W=function(){var e=this,t=e.items[e.currentItemIndex];"string"==typeof t.title&&""!=t.title&&e.$itemTitle.html(t.title).stop(!0).fadeTo(200,1),(e.options.socialButtons.facebook||e.options.socialButtons.twitter||e.options.socialButtons.gplus||e.options.socialButtons.inshare||e.options.socialButtons.pinterest&&"image"==t.type)&&"string"==typeof t.socialUrl&&""!=t.socialUrl?e.$socialButtonsTrigger.css("display",""):e.$socialButtonsTrigger.css("display","none")},k=function(e){var t=this.items.length;return 0>e?e=t-1:e>=t&&(e=0),e},b=function(){var t=this;if(t.$itemTitle.text("").stop(!0).fadeTo(0,0),t.$socialButtonsTrigger.removeClass("show"),t.$socialButtonsWrapper.removeClass("show").html(""),t.currentItemIndex=k.call(t,t.currentItemIndex),t.$root.removeClass("firstItem lastItem"),0===t.currentItemIndex&&t.$root.addClass("firstItem"),t.currentItemIndex===t.items.length-1&&t.$root.addClass("lastItem"),t.smbPlus){var a=k.call(t,t.currentItemIndex-1),o=k.call(t,t.currentItemIndex+1);e("> div.videoItem.item_"+a+",> div.audioItem.item_"+a+",> div.videoItem.item_"+o+",> div.audioItem.item_"+o,t.$contentWrapper).html(""),W.call(t)}var n=t.items[t.currentItemIndex],i="imageActive";"video"==n.type?i="videoActive":"audio"==n.type&&(i="audioActive"),t.$root.removeClass("imageActive videoActive audioActive").addClass(i),t.showItem()},x=function(){var e=this;if(e.smbPlus){var a=e.$window.height();t.innerHeight&&(a=t.innerHeight),a+=1,e.$root.height(a),e.overlayWidth=e.$root.width(),e.overlayHeight=a}else e.overlayWidth=e.$contentWrapper.width(),e.overlayHeight=e.$contentWrapper.height();e.center()},T=function(e){var t=this;if(!(t.skipGestures||-1==e&&0==t.currentItemIndex||1==e&&t.currentItemIndex==this.items.length-1)){t.skipGestures=!0;var a=-t.currentItemIndex*t.overlayWidth;1==e?a-=t.overlayWidth:a+=t.overlayWidth,t.$contentWrapper.removeClass(p).addClass(u).css({transform:"translate3d("+a+"px, 0, 0)"}),setTimeout(function(){t.currentItemIndex+=e,b.call(t),t.skipGestures=!1},250)}},L=function(){var e=this;if(e.initialItemLoaded){if(e.smbPlus)return void T.call(e,-1);e.currentItemIndex-=1,b.call(e)}},B=function(){var e=this;if(e.initialItemLoaded){if(e.smbPlus)return void T.call(e,1);e.currentItemIndex+=1,b.call(e)}},M=function(){var e=this;("function"!=typeof e.options.events.onBeforeClose||e.options.events.onBeforeClose({activeItem:e.currentItemIndex,displayItems:e.items})!==!1)&&(e.$document.off(".smbLightEvent"),e.$window.off(".smbLightEvent"),e.viewClosed=!0,e.$root.stop(!0).fadeOut(200,function(){e.$root.remove(),e.$body.removeClass(m)}),e.smbPlus&&(void 0===e.oldViewportMetaContent?e.$viewportMeta.remove():e.$viewportMeta.attr("content",e.oldViewportMetaContent),void 0===e.oldIeTapHighlight?e.$ieTapHighlight.remove():e.$ieTapHighlight.attr("content",e.oldIeTapHighlight)))},A=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},S=function(){var t=this,a=t.items[t.currentItemIndex],o=t.comments[a.id],n="";return t.$mainCommentsCount.text(o.count),t.$internalCommentsCount.text(o.count),0==o.cache.comments.length?(t.$commentList.html(""),void t.$commentsModal.addClass("noComments")):(t.$commentsModal.removeClass("noComments"),e.each(o.cache.comments,function(){var a=o.cache.authors[this.author],i=encodeURI(a.url),s='<li><a class="authorAvatar" href="'+i+'"><img src="'+encodeURI(a.avatar)+'" alt="" /></a><a class="author" href="'+i+'">'+e("<p />").text(a.name).html()+"</a><div>"+this.content+'</div><p class="datetime">'+this.dateHtml+"</p></li>";"asc"==t.commentSorting?n+=s:n=s+n}),void t.$commentList.html(n))},O=function(a,o){var i=this;return i.$body=e("body"),i.$body.hasClass(m)||0==a.length?!1:(i.$body.addClass(m),i.$window=e(t),i.$document=e(document),i.initialItemLoaded=!1,i.viewClosed=!1,i.items=a,i.options=e.extend(!0,{},n,o),i.currentItemIndex=i.options.openAt,(i.currentItemIndex<0||i.currentItemIndex>=a.length)&&(i.currentItemIndex=0),i.images={},!0)},P=function(){var t=this;t.$window.on("resize.smbLightEvent",function(){var e=t.items[t.currentItemIndex],a=t.comments[e.id];t.desktopVersion&&a&&a.state.open&&t.$root.width(t.$window.width()-t.$commentsModal.outerWidth(!0)),x.call(t)}),t.$document.on("keyup.smbLightEvent",function(e){switch(e.keyCode){case 37:L.call(t);break;case 39:B.call(t);break;case 27:if(t.commentsOpened)return t.closeComments(),!1;M.call(t)}return!1}),t.$root.on("click",".navigation",function(){t.$root.hasClass("initializing")||(e(this).hasClass("prev")?L.call(t):B.call(t))}).on("click",".close",function(){M.call(t)}),t.$socialButtonsTrigger.on("click",function(){if(!t.$root.hasClass("initializing")){var a=t.items[t.currentItemIndex],o=encodeURIComponent(a.socialUrl),n="",i="";"string"==typeof a.title==a.title!=""&&(n=a.title.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=encodeURIComponent(a.title));var s="";t.options.socialButtons.facebook&&(s='<div><iframe src="//www.facebook.com/plugins/like.php?href='+o+'&amp;width&amp;layout=button_count&amp;action=like&amp;show_faces=false&amp;share=false&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; height:21px; width: 135px;" allowTransparency="true"></iframe></div>'),t.options.socialButtons.twitter&&(s+='<div><a href="//twitter.com/share" class="twitter-share-button" data-url="'+o+'" data-text="'+n+'">Tweet</a><script type="text/javascript">twttr.widgets.load();</script></div>'),t.options.socialButtons.gplus&&(s+='<div><div class="g-plusone" data-size="medium" data-href="'+a.socialUrl+'"></div><script type="text/javascript">gapi.plusone.go();</script></div>'),t.options.socialButtons.inshare&&(s+='<div><script type="IN/Share" data-url="'+a.socialUrl+'" data-counter="right"></script><script type="text/javascript">if (IN.parse) IN.parse();</script></div>'),t.options.socialButtons.pinterest&&"image"==a.type&&(s+='<div><a href="//www.pinterest.com/pin/create/button/?url='+o+"&media="+encodeURIComponent(a.src)+"&description="+i+'" data-pin-do="buttonPin" data-pin-config="beside"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_gray_20.png" /></a></div>'),""!=s&&(t.$socialButtonsWrapper.toggleClass("show").html(s),t.options.socialButtons.pinterest&&"image"==a.type&&e.ajax({url:"//assets.pinterest.com/js/pinit.js",dataType:"script",cache:!0}),e(this).toggleClass("show"))}})},H=function(e){var t=this,a=t.options.i18n[e];return a?a:e};a.prototype={center:function(){var e,t,a=this,o={},n=!1,i=0,s=0,r=!1,m=!1;if(a.initialItemLoaded){switch(e=a.items[a.currentItemIndex],e.type){case"image":t=a.images[e.src].stats,t.isLoaded?(i=t.width,s=t.height):(i=400,s=400);break;case"video":i=e.width,s=e.height,r=!0;break;case"audio":i=460,s=36,m=!0}o=f.call(a,i,s,r,m),n=!0}n||(o.width=a.$mainWrapper.width(),o.height=a.$mainWrapper.height(),o.left=Math.floor((a.overlayWidth-(o.width+a.main.horizontalSpace))/2),o.top=Math.floor((a.overlayHeight-(o.height+a.main.verticalSpace))/2)),a.$mainWrapper.stop(!0).css(o)},showItem:function(){var t=this;t.$imagesWrapper.removeClass(r),t.$loadingOverlay.addClass("inProgress").stop(!0).fadeTo(0,1,function(){t.$loadingOverlay.css("display","")}),t.$audioVideo.html(""),e("> .viewWrapper > div",t.$mainWrapper).removeClass(s),t.$mainWrapper.removeClass(l).removeClass(c).removeClass(d);var a=t.items[t.currentItemIndex];switch(a.type){case"image":I.call(t,a);break;case"video":w.call(t,t.currentItemIndex);break;case"audio":y.call(t,a);break;default:t.initialItemLoaded=!0}t.initialItemLoaded&&t.$root.removeClass("initializing")}},o.prototype={center:function(){var t=this,a=0;t.options.comments.permissions.show&&(a=e(">",t.$commentsModal).height()-t.$commentsTopBar.outerHeight(!0)-t.$newCommentWrapper.outerHeight(!0),0>a&&(a=0),t.$commentList.css("height",a)),t.$contentWrapper.removeClass(p).removeClass(u).css({width:t.items.length*t.overlayWidth,transform:"translate3d(-"+t.currentItemIndex*t.overlayWidth+"px, 0, 0)"}),e(">",t.$contentWrapper).width(t.overlayWidth).each(function(){var a=e(this),o=a.data("itemIndex"),n=t.items[o];if(!(a.hasClass("loading")||"image"!=n.type&&o!=t.currentItemIndex))if("image"==n.type){var i=t.images[n.src].stats;e("> img",a).css(f.call(t,i.width,i.height,!1))}else"video"==n.type?e("> div",a).css(f.call(t,n.width,n.height,!0)):"audio"==n.type&&e("> div",a).css(f.call(t,460,36,!1,!0))})},showItem:function(){var t=this,a=e("> div.item_"+t.currentItemIndex,t.$contentWrapper),o=t.currentItemIndex,n=t.items[o],s=function(){o>0&&g.call(t,k.call(t,o-1)),o<t.items.length-1&&g.call(t,k.call(t,o+1))};switch(t.$contentWrapper.removeClass(p).removeClass(u).css({transform:"translate3d(-"+o*t.overlayWidth+"px, 0, 0)"}),t.options.comments.permissions.show&&(t.$newCommentInput.val(""),t.$newCommentWrapper.removeClass("filledIn"),t.comments[n.id]||(t.comments[n.id]={state:{open:!1,commentsRequest:i.UNSET},count:n.comments.count,cache:{authors:{},comments:[]}}),t.$mainCommentsCount.text(t.comments[n.id].count),t.desktopVersion&&(e.each(t.comments,function(){this.state.open=!1}),t.updateItemComments())),t.options.like.permissions.liking&&(t.$likeTrigger.toggleClass("liked",n.likes.likedByUser),t.$mainLikeCount.text(n.likes.numOfLikes)),n.type){case"image":if(a.data(h))return;g.call(t,o,function(){t.currentItemIndex==o&&(t.initialItemLoaded=!0,s())}),a.data(h,!0);break;case"video":w.call(t,t.currentItemIndex);break;case"audio":y.call(t,n);break;default:t.initialItemLoaded=!0}"image"!=n.type&&s(),t.$root.removeClass("initializing")},updateItemComments:function(){var t=this,a=t.currentItemIndex,o=t.items[a],n=t.comments[o.id];n.state.open||t.$root.hasClass("initializing")||(n.state.open=!0,n.state.commentsRequest==i.UNSET?(n.state.commentsRequest=i.SENT,t.$commentsModal.addClass("loading"),e.ajax({data:{action:"list_comments"},dataType:"json",type:"GET",url:o.comments.backend,timeout:15e3,cache:!1,error:function(){n.state.commentsRequest=i.UNSET},success:function(e){n.cache=e,n.count=e.comments.length,n.state.commentsRequest=i.DONE},complete:function(){n.state.open&&a==t.currentItemIndex&&(t.$commentsModal.removeClass("loading"),S.call(t))}})):(S.call(t),t.$commentsModal.removeClass("loading")),t.$internalCommentsCount.text(n.count),t.$commentsLikes.text(o.likes.numOfLikes).toggleClass("liked",o.likes.likedByUser))},closeComments:function(){var e=this,t=e.items[e.currentItemIndex],a=e.comments[t.id];a.state.open=!1,e.desktopVersion?(clearTimeout(e.commentsAnimationTimeout),e.$root.addClass("moveComments"),e.$root.css("width",""),x.call(e),e.$root.addClass("animateComments").removeClass("moveComments"),e.commentsAnimationTimeout=setTimeout(function(){e.$root.removeClass("animateComments")},300)):(e.$root.removeClass("modalActive"),e.$modalOverlay.stop(!0).animate({opacity:0},{duration:200})),e.$commentsModal.removeClass("showAnonymWindow"),e.$anonymCommentWrapper.removeClass("addingAnonComment"),e.commentsOpened=!1}},t.SmbLight_1=function(e,t){return this instanceof SmbLight_1?t.mobile?new o(e,t):new a(e,t):new SmbLight_1(e,t)}}(eds2_2,window);